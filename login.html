const SPREADSHEET_ID = "TON_ID_SHEET";

function doGet(e) {
  const action = e.parameter.action;
  const sheet = SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName("USERS");
  const data = sheet.getDataRange().getValues();

  if (action === "login") {
    const id = e.parameter.id;
    const pass = e.parameter.pass;
    for (let i = 1; i < data.length; i++) {
      if ((data[i][1] == id || data[i][2] == id) && data[i][3] == pass) {
        return ContentService.createTextOutput(JSON.stringify({
          "success": true,
          "role": data[i][4] || "tech", 
          "name": data[i][0]
        })).setMimeType(ContentService.MimeType.JSON);
      }
    }
    return ContentService.createTextOutput(JSON.stringify({ "success": false })).setMimeType(ContentService.MimeType.JSON);
  }

  if (action === "register") {
    const name = e.parameter.name;
    const phone = e.parameter.phone;
    const email = e.parameter.email;
    const pass = e.parameter.pass;
    
    // AJOUT LITTÉRAL : role="tech" par défaut
    sheet.appendRow([name, phone, email, pass, "tech"]); 
    
    return ContentService.createTextOutput(JSON.stringify({ 
      "success": true, 
      "role": "tech" 
    })).setMimeType(ContentService.MimeType.JSON);
  }
}
